<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>01-07注册百度账号4(方法二)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }
        .reg {
            width: 980px;
            margin: 50px auto;
        }
        .reg div {
            position: relative;
            margin-bottom: 20px;
            zoom: 1;
            display: block;
        }
        .reg div:after {
            content: "";
            clear: both;
            display: block;
            visibility: hidden;
            height: 0;
        }
        .reg label {
            display: block;
            float: left;
            height: 42px;
            width: 65px;
            margin-right: 10px;
            line-height: 42px;
            font-size: 14px;
            color: #666;
            font-weight: 700;
            text-align: right;
        }
        .reg input {
            display: block;
            position: relative;
            float: left;
            height: 16px;
            width: 328px;
            padding: 11px 10px;
            margin-right: 10px;
            border: 1px solid #ddd;
            font-size: 14px;
            color: #666;
            transition: .3s;
            float: left;
        }
        #verify-box input:nth-of-type(1){
             width: 158px;
        }
        #verify-box input:nth-of-type(2){
            border-radius: 0;
            height: 40px;
            background: #f7f7f7;
            font-weight: 400;
            width: 160px;
            text-align: center;
            cursor: pointer;
        }
        #verify-box input:nth-of-type(2):focus{
            border: 1px solid #ddd;
        }
        #verify-box input:nth-of-type(2):hover
        {
            background-color: #eee;
        }
        #verify-box .cancel{
            left: 212px;
        }
        .reg .subBtn {
            position: relative;
            left: 75px;
        }
        .reg .subBtn input {
            display: block;
            height: 50px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            color: #fff;
            background-image: none;
            border-radius: 3px;
            border: 0;
            float: left;
            width: 350px;
            background-color: #3f89ec;
        }
        .reg input:focus {
            border-color: #488ee7;
            outline: 0;
        }
        .msg{
            display: none;
        }
        .ok {
            display: inline-block;
            position: relative;
            float: left;
            top: 14px;
            height: 16px;
            line-height: 12px;
            padding-left: 20px;
            background: url(images/reg_icons.png) -80px 0 no-repeat;
        }
        .err {
            float: left;
            position: relative;
            width: 250px;
            top: 12px;
            color: #fc4343;
            height: 16px;
            line-height: 14px;
            padding-left: 20px;
            background: url(images/reg_icons.png) -80px -23px no-repeat;
            font-size: 12px;
        }
        .cancel {
            position: absolute;
            width: 16px;
            height: 16px;
            background: url(images/reg_icons.png) -32px -24px no-repeat;
            top: 12px;
            left: 398px;
            cursor: pointer;
        }
        .cancel:hover {
            background-position: -48px -24px;
        }
        .tiptext {
            font-size: 12px;
            color: #aaa;
            height: 40px;
            line-height: 40px;
        }
        #username-box .tiptext{
            line-height: 18px;
            width: 250px;
            float: left;
        }
        #pwdChecklist{
            margin-left: 10px;
            padding: 5px 10px;
            border: 1px solid #ddd;
            box-shadow: 1px 1px 1px #efefef;
            background: #f9f9f9;
            width: 200px;
            font-size: 12px;
            position: absolute;
            top: 0;
            right: 318px;
        }
        .pwd-checklist li{
            list-style: none;
        }
        .pwd-checklist .pwd-checklist-item-success {
            background-position: -86px -128px;
        }
        .pwd-checklist  .pwd-checklist-item-error {
            color: rgb(252, 67, 67);
            background-position: -86px -144px;
        }
        .pwd-checklist-item {
            line-height: 20px;
            padding-left: 18px;
            background: url(images/reg_icons.png) no-repeat -86px -112px;
            color: #666;
        }
        .pwd-checklist-arrow{
            width: 14px;
            height: 14px;
            background: #f9f9f9;
            position: absolute;
            top: 12px;
            left: -7px;
            transform: rotateZ(45deg);
            border-bottom: 1px solid #ddd;
            border-left: 1px solid #ddd;       
        }
        #agree-box{
            font-size: 12px;
        }
        #agree-box a{
            text-decoration: none;
        }
        #agree-box label{
            width: 60px;
            height: 40px;
            vertical-align: top;
            font-size: 12px;
            color: #666;
            font-weight: normal;
            margin:-12px 0px 0px 2px;
        }
        #agree-box input{
            width: 20px;
            margin: 1px 0px 0px 70px;
        }
        #agree-box .msg{
            float: none;
            top: 0;
            color: #fc4343;
        }
    </style>
    <script>
    	//用来判断汉字的长度
    	function getlength(str){
    		return str.replace(/[\u4e00-\u9fa5]/g,'aa').length;   //把汉字换成字符
    	}
    	//整合函数来判断条件不满足时对应的样式
    	function setErr(oMsg,sMsg,oInput){  //给谁设置,字符串,input框变色
    		oMsg.className='err';   //图标
    		oMsg.innerHTML=sMsg; // 提示信息
    		oInput.style.borderColor='red';  //边框变色
    	}
        function setOk(oMsg,sMsg,oInput){
            oMsg.className='ok';   //图标
            sMsg.innerHTML='';
            oInput.style.borderColor='#ddd';  //边框变色
        }
    	window.onload=function(){
    		//1.获取元素
    		var oForm=document.forms[0];
    		var oUsername=oForm.username;
    		var oPhone=oForm.phone;
    		var oPwd=oForm.password;
            var oVerify=oForm.verify;
    		var oPwdCheckList=document.getElementById('pwdChecklist');
    		var aLi=document.getElementsByTagName('li');
    		var aCancel=document.querySelectorAll('.cancel');
    		var aMsg=document.querySelectorAll('.msg');
            var oSmsBtn=document.getElementById('smsBtn');
            var oSubBtn=document.getElementById('subBtn');
            var oIsAgree=document.getElementById('isAgree');
    		//2.设置默认焦点和提示

            //定义全局变量
            var bphone=false;
            var busername=false;
            var bpassword=false;
            var bverify=false;
            //调用
    		init();     		
    		checkUserName();
    		checkPhone();
    		checkPassword();
    		checkVerify();
    		checkSubmit();
    		//初始化
    		function init(){
    			oUsername.focus();
    			aMsg[0].className='tiptext';
    			aMsg[0].innerHTML='设置后不可更改 <br> 中英文均可,最长14个英文或7个汉字';
                //事件委托给form,通过判断长度出现cancel图标
                oForm.oninput=function(ev){
                    var oEvent=ev || event;
                    // console.log(oEvent.target);  //拿到的是input
                    var oInput=oEvent.target;
                    var oCancel=oInput.nextElementSibling;
                    // console.log(oCancel);
                    if(oInput.value.length>0){
                        oCancel.style.display='block';
                    }else{
                        oCancel.style.display='none';
                    }
                }  
                //点cancel取消操作 
                oForm.onclick=function(ev){
                    var oEvent=ev || event;
                    var oSpan=oEvent.target;                 	
                  	// console.log(oSpan.dataset.obj);    //取到username
                  	var sInput=oSpan.dataset.obj;
                  	if(sInput=='username'||sInput=='phone'||sInput=='password'||sInput=='verify'){
                  		oForm[sInput].value='';
                        oSpan.style.display='none';
                        oForm[sInput].focus();
                  	}
    		    } 
            }
    		//验证手机号  		
    		function checkUserName(){
	    		oUsername.onfocus=function(){
	    			// console.log('aa');
	    			aMsg[0].className='tiptext';
	    			aMsg[0].innerHTML='设置后不可更改 <br> 中英文均可,最长14个英文或7个汉字';
	    			oUsername.style.borderColor='#488ee7';
	    		}
	    		//4.当失去焦点时去验证规则
	    		oUsername.onblur=function(){
	    			aMsg[0].className='msg'; //一开始设置成默认的样式(不显示)
	    			var ovalue=oUsername.value;
	    			oUsername.style.borderColor='#ddd';
	    			var reg1=/[^\u4e00-\u9fa5|a-z|0-9|-]/;   //取反
	    			var reg2=/^\d+$/;  				//开始和结束
	    			var reg3=/^\s+$/;				//开始和结束
	    			if(ovalue ==''){
	    				busername=false;
	    			}  					
	    			else if(getlength(ovalue)>14){
	    				setErr(aMsg[0],'用户名不能超过7个汉字或14个字符',oUsername);
                        busername=false;
	    			}else if(reg3.test(ovalue)){
	    				setErr(aMsg[0],'请输入用户名',oUsername);
                        busername=false;
	    			}
	    			else if(reg1.test(ovalue)||reg2.test(ovalue)){
	    				setErr(aMsg[0],'用户名仅支持中英文、数字和下划线,且不能为纯数字',oUsername);
                        busername=false;
	    			}else{
	    				// aMsg[0].className='ok';   //图标
	    				// aMsg[0].innerHTML='';
	    				// oUsername.style.borderColor='#ddd';  //边框变色
                        setOk(aMsg[0],aMsg[0],oUsername);
                        busername=true;
	    			}
	    		}
    		}
    		function checkPhone(){
	    		//5.返回重新获取焦点
	    		oPhone.onfocus=function(){
	    			aMsg[1].className='tiptext';
	    			aMsg[1].innerHTML='请输入中国大陆手机号,其他用户不可见';
	    			oPhone.style.borderColor='#488ee7';
	    		}
	    		//4.当失去焦点时去验证规则
	    		oPhone.onblur=function(){
	    			aMsg[1].className='msg'; //一开始设置成默认的样式(不显示)
	    			oPhone.style.borderColor='#ddd';
	    			var ovalue=oPhone.value;
	    			var reg1=/^\s+$/;
	    			var reg2=/^1[35789]\d{9}$/;	    			
	    			if(ovalue ==''){
	    				bphone=false;
	    			}else if(reg1.test(ovalue)){
	    				setErr(aMsg[1],'请输入手机号',oPhone);
                        bphone=false;
	    			}else if(!reg2.test(ovalue)){
	    				setErr(aMsg[1],'手机号码格式不正确',oPhone);
                        bphone=false;
	    			}else{
	    				// aMsg[1].className='ok';   //图标
	    				// aMsg[1].innerHTML='';
	    				// oPhone.style.borderColor='#ddd';  //边框变色
                        setOk(aMsg[1],aMsg[1],oPhone);
                        bphone=true;
	    			}
	    		}
	    		oPhone.onkeydown=function(ev){
	    			var oEvent=ev ||event;
	    			// console.log(oEvent.keyCode);
	    			if((oEvent.keyCode<48||oEvent.keyCode>57||oPhone.value.length>10)
	    				&&oEvent.keyCode!=8
	    				&&oEvent.keyCode!=37
	    				&&oEvent.keyCode!=39

	    			){
	    				return false;
	    			}
	    		}   		   		
    	    }
    	    function checkPassword(){
    	    	oPwd.onclick=function(){
    	    		oPwdCheckList.style.display='block';
    	    		oPwd.style.borderColor='#488ee7';
    	    	}
    	    	var pwd1=false;
	    	   	var pwd2=false;
	    	    var pwd3=false;
    	    	oPwd.oninput=function(){
    	    		var succ='pwd-checklist-item pwd-checklist-item-success' ;
	    	    	var error='pwd-checklist-item pwd-checklist-item-error' ;
	    	    	var ovalue=oPwd.value;
	    	    	
	    	    	//长度为6~14个字符
	    	    	var reg1=/^.{6,14}$/;  //除了回车和换行
	    	    	//支持数字,大小写字母和标点符号
	    	    	var reg2=/[^0-9a-z\^\*\[\]\(\)]/i;
	    	    	//不允许有空格
	    	    	var reg3=/\s/;  //有空格是错误
	    	    	
	    	    	if(reg1.test(ovalue)){
	    	    		aLi[0].className=succ;
	    	    		pwd1=true;
	    	    	}else{
	    	    		aLi[0].className=error;
	    	    		pwd1=false;
	    	    	}
	    	    	if(reg2.test(ovalue)){
	    	    		aLi[1].className=error;
	    	    		pwd2=false;
	    	    	}else{
	    	    		aLi[1].className=succ;
	    	    		pwd2=true;
	    	    	}
	    	    	if(reg3.test(ovalue)){
	    	    		aLi[2].className=error;
	    	    		pwd3=false;
	    	    	}else{
	    	    		aLi[2].className=succ;
	    	    		pwd3=true;
	    	    	}
    	    	}
    	    	oPwd.onblur=function(){
    	    		aMsg[2].className='msg'; //一开始设置成默认的样式(不显示)
	    			oPwd.style.borderColor='#ddd';
    	    		if(pwd1&&pwd2&&pwd3){
    	    			oPwdCheckList.style.display='none';
    	                   //aMsg[2].className='ok';   //图标
	    				   // aMsg[2].innerHTML='';
	    				   // oPwd.style.borderColor='#ddd';  //边框变色
                        setOk(aMsg[2],aMsg[2],oPwd);
                        bpassword=true;
    	    		}else{
                        bpassword=false;
                    }
    	    		if(oPwd.value==''){
    	    			oPwdCheckList.style.display='none';
                        bpassword=false;
    	    		}
    	    	}
    	    	aCancel[2].onclick=function(){
    	    		pwd1=false;
	    	   		pwd2=false;
	    	        pwd3=false;
	    	        oPwdCheckList.style.display='block';
	    	        for(var i=0;i<aLi.length;i++){
	    	        	aLi[i].className='pwd-checklist-item';
	    	        }
    	    	}
    	    }
    	    function checkVerify(){
            //监听获取验证码事件
                oSmsBtn.onclick=function(){                
                    if(oPhone.value==''){
                        setErr(aMsg[1],'请输入手机号',oPhone);
                    }
                    if(!bphone){  //如果不是真的话
                        return false;
                    }
                    console.log('get sms...');                   
                }
                oVerify.onblur=function(){
                    if(oVerify.value.length==6){
                        bverify=true;
                    }else{
                        bverify=false;
                    }
                }
            }
            function checkSubmit(){
                //什么都没输的提示
                oSubBtn.onclick=function(){
                    if(oUsername.value==''){
                        setErr(aMsg[0],'请输入用户名',oUsername);
                    }
                    if(oPhone.value==''){
                        setErr(aMsg[1],'请输入手机号',oPhone);
                    }
                    if(oPwd.value==''){
                        setErr(aMsg[2],'请输入密码',oPwd);
                    }
                    if(oPwd.value==''){
                        setErr(aMsg[2],'请输入密码',oPwd);
                    }
                    if(oVerify.value==''){
                        // setErr(aMsg[3],'请输入验证码',oVerify);
                        aMsg[3].className='err';
                        aMsg[3].innerHTML='请输入验证码';
                    }else{
                        aMsg[3].className='msg';
                    }
                    if(!oIsAgree.checked){
                        aMsg[4].style.display=='inline';
                    }else{
                        aMsg[4].style.display='none';
                    }
                    //同时满足提交
                    if(busername&&bphone&&bpassword&&bverify&&oIsAgree.checked){
                        oForm.submit();
                    }
                }
 
            }
        }
    </script>
</head>

<body>
    <div class="reg" id='reg'>
        <form action="http://www.kuazhu.com">
            <div id="username-box">
                <label for="username">用户名</label>
                <input type="text" name="username" placeholder="请设置用户名">
                <span class="cancel" data-obj="username" style="display: none;"></span>
                <span class="msg"></span>
            </div>
            <div id="phone-box">
                <label for="phone">手机号</label>
                <input type="text" name="phone" placeholder="可用于登录和找回密码">
                <span class="cancel" data-obj="phone" style="display: none;"></span>
                <span class="msg"></span>
            </div>
            <div id="pwd-box" class="pwd-box">
                <label for="password">密码</label>
                <input type="password" name="password" placeholder="请设置登录密码"/>
                <span class="cancel" data-obj="password" style="display: none;"></span>
                <span class="msg"></span>
                <div id="pwdChecklist" class="pwd-checklist" style="display:none">
                    <ul>
                        <li class="pwd-checklist-item ">长度为6~14个字符</li>
                        <li class="pwd-checklist-item ">支持数字,大小写字母和标点符号</li>
                        <li class="pwd-checklist-item ">不允许有空格</li>
                    </ul>
                    <span class="pwd-checklist-arrow"></span>
                </div>
            </div>
            <div id="verify-box">
                <label for="verify">验证码</label>
                <input type="text" name="verify" placeholder="请输入验证码">
                <span class="cancel"  data-obj="verify" style="display: none;">
                </span>
                <input type="button"  id="smsBtn" value="获取短信验证码">
                <span class="msg"></span>       
            </div> 
            <div id='agree-box'>
               <input type="checkbox" name='isAgree' id='isAgree'> 
               <label for="isAgree">阅读并接受</label>
               <a href="#">《百度用户协议》</a>及<a href="#">《百度隐私权保护声明》</a>  
               <span class="msg" id='agreeErr'>选“阅读并接受百度用户协议”</span>               
            </div>           
            <div class="subBtn">
                <input type="button" value="注册" id="subBtn">
            </div>
        </form>
    </div>
</body>
</html>